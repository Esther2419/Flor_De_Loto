generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model categorias {
  id                       BigInt       @id @default(autoincrement())
  nombre                   String       @db.VarChar(100)
  descripcion              String?
  foto                     String?
  fecha_creacion           DateTime?    @default(now()) @db.Timestamp(6)
  fecha_actualizacion      DateTime?    @db.Timestamp(6)
  usuario_actualizacion_id BigInt?
  categoria_padre_id       BigInt?
  portada                  String?
  usuarios                 usuarios?    @relation(fields: [usuario_actualizacion_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_cat_audit")
  categorias               categorias?  @relation("categoriasTocategorias", fields: [categoria_padre_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_cat_padre")
  other_categorias         categorias[] @relation("categoriasTocategorias")
  ramos                    ramos[]
}

model flores {
  id                       BigInt                @id @default(autoincrement())
  nombre                   String                @db.VarChar(100)
  descripcion              String?
  color                    String?               @db.VarChar(50)
  foto                     String?
  precio_unitario          Decimal               @db.Decimal(10, 2)
  disponible               Boolean?              @default(true)
  fecha_creacion           DateTime?             @default(now()) @db.Timestamp(6)
  fecha_actualizacion      DateTime?             @db.Timestamp(6)
  usuario_actualizacion_id BigInt?
  cantidad                 Int                   @default(0)
  carrito_detalle          carrito_detalle[]
  detalle_pedidos          detalle_pedidos[]
  usuarios                 usuarios?             @relation(fields: [usuario_actualizacion_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_flor_audit")
  ramo_detalle             ramo_detalle[]
  reserva_adicionales      reserva_adicionales[]
}

model envolturas {
  id                       BigInt            @id @default(autoincrement())
  nombre                   String            @db.VarChar(100)
  color                    String?           @db.VarChar(50)
  diseno                   String?           @db.VarChar(100)
  foto                     String?
  precio_unitario          Decimal           @default(0) @db.Decimal(10, 2)
  disponible               Boolean?          @default(true)
  fecha_creacion           DateTime?         @default(now()) @db.Timestamp(6)
  fecha_actualizacion      DateTime?         @db.Timestamp(6)
  usuario_actualizacion_id BigInt?
  cantidad                 Int               @default(0)
  carrito_detalle          carrito_detalle[]
  detalle_pedidos          detalle_pedidos[]
  usuarios                 usuarios?         @relation(fields: [usuario_actualizacion_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_envoltura_audit")
  ramo_envolturas          ramo_envolturas[]
  reservas                 reservas[]
}

model ramo_envolturas {
  id           BigInt     @id @default(autoincrement())
  ramo_id      BigInt
  envoltura_id BigInt
  cantidad     Int?       @default(1)
  envolturas   envolturas @relation(fields: [envoltura_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_env_det")
  ramos        ramos      @relation(fields: [ramo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ramo_env")
}

model ramo_detalle {
  id            BigInt @id @default(autoincrement())
  ramo_id       BigInt
  flor_id       BigInt
  cantidad_base Int?   @default(1)
  flores        flores @relation(fields: [flor_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_flor_det")
  ramos         ramos  @relation(fields: [ramo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ramo_det")
}

model ramo_imagenes {
  id       BigInt @id @default(autoincrement())
  ramo_id  BigInt
  url_foto String
  ramos    ramos  @relation(fields: [ramo_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ramo_img")
}

model ramos {
  id                       BigInt            @id @default(autoincrement())
  nombre                   String            @db.VarChar(150)
  descripcion              String?
  precio_base              Decimal           @db.Decimal(10, 2)
  categoria_id             BigInt?
  activo                   Boolean?          @default(true)
  fecha_creacion           DateTime?         @default(now()) @db.Timestamp(6)
  fecha_actualizacion      DateTime?         @db.Timestamp(6)
  usuario_actualizacion_id BigInt?
  tipo                     String?           @db.VarChar
  es_oferta                Boolean?          @default(false)
  precio_oferta            Decimal?          @db.Decimal(10, 2)
  foto_principal           String?
  carrito_detalle          carrito_detalle[]
  detalle_pedidos          detalle_pedidos[]
  ramo_detalle             ramo_detalle[]
  ramo_envolturas          ramo_envolturas[]
  ramo_imagenes            ramo_imagenes[]
  categorias               categorias?       @relation(fields: [categoria_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_categoria")
  usuarios                 usuarios?         @relation(fields: [usuario_actualizacion_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ramo_audit")
  reservas                 reservas[]
}

model reserva_adicionales {
  id                BigInt   @id @default(autoincrement())
  reserva_id        BigInt
  flor_id           BigInt
  cantidad          Int
  precio_al_momento Decimal? @db.Decimal(10, 2)
  tipo_entrega      String?  @default("integrado") @db.VarChar(20)
  flores            flores   @relation(fields: [flor_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_flor_adic")
  reservas          reservas @relation(fields: [reserva_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reserva_adic")
}

model reservas {
  id                                                   BigInt                @id @default(autoincrement())
  usuario_id                                           BigInt?
  nombre_contacto                                      String                @db.VarChar(150)
  telefono_contacto                                    String                @db.VarChar(20)
  correo_contacto                                      String?               @db.VarChar(150)
  ramo_catalogo_id                                     BigInt?
  es_personalizado                                     Boolean?              @default(false)
  foto_referencia_cliente                              String?
  descripcion_solicitud                                String?
  envoltura_elegida_id                                 BigInt?
  precio_envoltura_momento                             Decimal?              @db.Decimal(10, 2)
  fecha_solicitud                                      DateTime?             @default(now()) @db.Timestamp(6)
  fecha_entrega                                        DateTime              @db.Timestamp(6)
  mensaje_dedicatoria                                  String?
  nombre_receptor                                      String?
  estado                                               String?               @default("pendiente") @db.VarChar(20)
  precio_final                                         Decimal?              @db.Decimal(10, 2)
  fecha_actualizacion                                  DateTime?             @db.Timestamp(6)
  usuario_actualizacion_id                             BigInt?
  reserva_adicionales                                  reserva_adicionales[]
  ramos                                                ramos?                @relation(fields: [ramo_catalogo_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ramo_reserva")
  usuarios_reservas_usuario_actualizacion_idTousuarios usuarios?             @relation("reservas_usuario_actualizacion_idTousuarios", fields: [usuario_actualizacion_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_reserva_audit")
  envolturas                                           envolturas?           @relation(fields: [envoltura_elegida_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_reserva_envoltura")
  usuarios_reservas_usuario_idTousuarios               usuarios?             @relation("reservas_usuario_idTousuarios", fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_usuario_reserva")
}

model usuarios {
  id                                                   BigInt               @id @default(autoincrement())
  nombre_completo                                      String               @db.VarChar(150)
  email                                                String               @unique @db.VarChar(150)
  password                                             String               @db.VarChar(255)
  celular                                              String?              @db.VarChar(20)
  rol                                                  String?              @default("cliente") @db.VarChar(20)
  foto                                                 String?
  activo                                               Boolean?             @default(true)
  fecha_registro                                       DateTime?            @default(now()) @db.Timestamp(6)
  carrito                                              carrito[]
  categorias                                           categorias[]
  envolturas                                           envolturas[]
  flores                                               flores[]
  pedidos_pedidos_aceptado_por_idTousuarios            pedidos[]            @relation("pedidos_aceptado_por_idTousuarios")
  pedidos_pedidos_entregado_por_idTousuarios           pedidos[]            @relation("pedidos_entregado_por_idTousuarios")
  pedidos_pedidos_rechazado_por_idTousuarios           pedidos[]            @relation("pedidos_rechazado_por_idTousuarios")
  pedidos_pedidos_terminado_por_idTousuarios           pedidos[]            @relation("pedidos_terminado_por_idTousuarios")
  pedidos                                              pedidos[]
  pedidos_historial                                    pedidos_historial[]
  ramos                                                ramos[]
  reservas_reservas_usuario_actualizacion_idTousuarios reservas[]           @relation("reservas_usuario_actualizacion_idTousuarios")
  reservas_reservas_usuario_idTousuarios               reservas[]           @relation("reservas_usuario_idTousuarios")
}

model configuracion {
  id                  Int       @id @default(autoincrement())
  tienda_abierta      Boolean?  @default(true)
  horario_apertura    DateTime? @default(dbgenerated("'09:00:00'::time without time zone")) @db.Time(6)
  horario_cierre      DateTime? @default(dbgenerated("'19:00:00'::time without time zone")) @db.Time(6)
  updated_at          DateTime? @default(now()) @db.Timestamptz(6)
  minutos_preparacion Int?      @default(30)
  cierre_temporal     Boolean?  @default(false)
  pedidos_por_hora    Int?      @default(5)
  qr_pago             String?
}

model detalle_pedidos {
  id              BigInt      @id @default(autoincrement())
  pedido_id       BigInt
  ramo_id         BigInt?
  cantidad        Int         @default(1)
  precio_unitario Decimal     @db.Decimal
  subtotal        Decimal     @db.Decimal
  personalizacion Json?
  flor_id         BigInt?
  envoltura_id    BigInt?
  envolturas      envolturas? @relation(fields: [envoltura_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  flores          flores?     @relation(fields: [flor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  pedidos         pedidos     @relation(fields: [pedido_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_pedido_cabecera")
  ramos           ramos?      @relation(fields: [ramo_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ramo_detalle")
}

model pedidos {
  id                                          BigInt               @id @default(autoincrement())
  usuario_id                                  BigInt?
  nombre_contacto                             String               @db.VarChar
  telefono_contacto                           String               @db.VarChar
  nombre_receptor                             String?
  fecha_pedido                                DateTime?            @default(now()) @db.Timestamp(6)
  fecha_entrega                               DateTime             @db.Timestamp(6)
  total_pagar                                 Decimal              @db.Decimal
  estado                                      String?              @default("pendiente") @db.VarChar
  aceptado_por_id                             BigInt?
  terminado_por_id                            BigInt?
  entregado_por_id                            BigInt?
  rechazado_por_id                            BigInt?
  fecha_aceptado                              DateTime?            @db.Timestamp(6)
  fecha_terminado                             DateTime?            @db.Timestamp(6)
  fecha_entregado                             DateTime?            @db.Timestamp(6)
  fecha_rechazado                             DateTime?            @db.Timestamp(6)
  motivo_rechazo                              String?
  comprobante_pago                            String?
  titular_cuenta                              String?              @db.VarChar(150)
  monto_transferencia                         Decimal?             @db.Decimal(10, 2)
  observacion_pago                            String?
  detalle_pedidos                             detalle_pedidos[]
  usuarios_pedidos_aceptado_por_idTousuarios  usuarios?            @relation("pedidos_aceptado_por_idTousuarios", fields: [aceptado_por_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_admin_aceptado")
  usuarios_pedidos_entregado_por_idTousuarios usuarios?            @relation("pedidos_entregado_por_idTousuarios", fields: [entregado_por_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_admin_entregado")
  usuarios_pedidos_rechazado_por_idTousuarios usuarios?            @relation("pedidos_rechazado_por_idTousuarios", fields: [rechazado_por_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_admin_rechazado")
  usuarios_pedidos_terminado_por_idTousuarios usuarios?            @relation("pedidos_terminado_por_idTousuarios", fields: [terminado_por_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_admin_terminado")
  usuarios                                    usuarios?            @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_usuario_pedido")
  pedidos_historial                           pedidos_historial[]
}

model carrito {
  id                  BigInt            @id @default(autoincrement())
  usuario_id          BigInt
  fecha_actualizacion DateTime?         @default(now()) @db.Timestamp(6)
  usuarios            usuarios          @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  carrito_detalle     carrito_detalle[]
}

model carrito_detalle {
  id              BigInt      @id @default(autoincrement())
  carrito_id      BigInt
  ramo_id         BigInt?
  cantidad        Int         @default(1)
  personalizacion Json?
  flor_id         BigInt?
  envoltura_id    BigInt?
  carrito         carrito     @relation(fields: [carrito_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  envolturas      envolturas? @relation(fields: [envoltura_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  flores          flores?     @relation(fields: [flor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ramos           ramos?      @relation(fields: [ramo_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model galeria {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  url_foto       String
  descripcion    String?
  fecha_creacion DateTime @default(now()) @db.Timestamptz(6)
}

model pedidos_historial {
  id              BigInt    @id @default(autoincrement())
  pedido_id       BigInt
  usuario_id      BigInt
  estado_anterior String?   @db.VarChar
  estado_nuevo    String    @db.VarChar
  observacion     String?
  fecha           DateTime? @default(now()) @db.Timestamp(6)
  pedidos         pedidos   @relation(fields: [pedido_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_historial_pedido")
  usuarios        usuarios  @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_historial_usuario")

  @@index([pedido_id], map: "idx_historial_pedido_id")
}

model bloqueos_horario {
  id             BigInt    @id @default(autoincrement())
  fecha          DateTime  @db.Date
  hora_inicio    DateTime? @db.Time(6)
  hora_fin       DateTime? @db.Time(6)
  motivo         String?
  fecha_creacion DateTime? @default(now()) @db.Timestamp(6)
}


enum tipo_ramo {
  mano
  copa
  caja
}
